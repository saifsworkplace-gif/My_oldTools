<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crypto Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Space+Grotesk:wght@600;700&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />

  <!-- Trade Decision Panel (temporary inline styles so you don't have to touch style.css yet) -->
  <style>
    /* --- Trade Decision Panel (namespaced) --- */
    .tdp{max-width:1100px;margin:24px auto;padding:20px;background:#0e1320;border:1px solid #1f2a44;border-radius:16px;box-shadow:0 0 0 1px rgba(255,255,255,.03) inset}
    .tdp__header{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .tdp__badge{padding:6px 10px;border-radius:999px;font-weight:600;background:rgba(59,130,246,.15);color:#93c5fd}
    .tdp__updated{color:#94a3b8;font-size:12px;margin-top:6px}
    .tdp__grid{display:grid;gap:12px;margin-top:12px;grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width:900px){.tdp__grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:600px){.tdp__grid{grid-template-columns:1fr}}
    .tdp__card{background:#0b1020;border:1px solid #1e293b;border-radius:12px;padding:12px}
    .tdp__card--wide{grid-column:span 2}
    .tdp h3{margin:0 0 6px;font-size:14px;color:#e2e8f0}
    .tdp p,.tdp li{color:#cbd5e1;font-size:13px;line-height:1.45;margin:0}
    .tdp__muted{color:#94a3b8}
    .tdp__list{padding-left:16px;margin:0}
    .tdp__map{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
    @media (max-width:600px){.tdp__map{grid-template-columns:repeat(2,1fr)}}
    .tdp__label{font-size:12px;color:#94a3b8}
    .tdp__value{font-weight:600;color:#e5e7eb}
  </style>
</head>
<body>
<div class="container">
  <header>
    <div class="title">⚡ Crypto Dashboard</div>
    <nav id="tabs">
      <a href="#portfolio" class="active">Portfolio</a>
      <a href="#market">Gainers</a>
      <a href="#technicals">Technicals</a>
    </nav>
    <div class="right">
      <div class="toolbar small">
        <label>TF</label>
        <select id="tfSelect">
          <option value="1h">1h</option>
          <option value="4h" selected>4h</option>
          <option value="1d">1d</option>
        </select>
      </div>
      <button id="refresh" class="ghost">Refresh</button>
    </div>
  </header>

  <!-- PORTFOLIO -->
  <section id="portfolio" class="section active">
    <div class="card">
      <div class="row" style="align-items:flex-end;">
        <div>
          <div style="font-weight:700;margin-bottom:.25rem;font-family:var(--font-head);font-size:1.1rem;">Your Portfolio</div>
          <div id="summary" class="muted">Cost: — · Value: —</div>
          <div class="muted">Edit inline. Data is saved in your browser. Use ✕ to remove any row.
            <span class="muted">(Add Coin starts blank — type a ticker like SOL, ADA, DOGE)</span>
          </div>
        </div>
        <div style="display:flex;gap:.5rem;justify-content:flex-end;">
          <button id="addRow" class="ghost">+ Add Coin</button>
        </div>
      </div>
      <div style="overflow:auto;margin-top:.75rem;max-height:70vh;">
        <table id="portfolioTable">
          <thead>
            <tr>
              <th>Coin</th><th>Ticker</th>
              <th class="rightnum">Qty</th>
              <th class="rightnum">Entry</th>
              <th class="rightnum">Live</th>
              <th class="rightnum">P&L</th>
              <th class="rightnum">P&L %</th>
              <th class="rightnum">RSI(14)</th>
              <th class="rightnum">MACD</th>
              <th class="rightnum">S/R (est)</th>
              <th>Chart</th><th class="rightnum"></th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr>
              <td colspan="5" class="rightnum" style="font-weight:700;font-family:var(--font-head);">Total P&L</td>
              <td id="totalPnL" class="rightnum">—</td>
              <td id="totalPnLPct" class="rightnum muted">—</td>
              <td colspan="5"></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </section>

  <!-- MARKET (Gainers) -->
  <section id="market" class="section">
    <div class="card">
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <div style="font-weight:700;font-family:var(--font-head);">Top 30 Gainers (24h, USDT) — auto-refresh every 5 min</div>
        <div class="muted" style="display:flex;gap:.5rem;align-items:center;">
          <span>Min Quote Vol</span><input id="gMinVol" type="number" placeholder="e.g. 10000000" style="width:130px;">
          <span>Min Price</span><input id="gMinPrice" type="number" step="0.01" placeholder="e.g. 0.10" style="width:110px;">
          <button id="gApply" class="ghost">Apply</button>
        </div>
      </div>
      <div id="gainersError" class="muted"></div>
      <div style="overflow:auto;margin-top:.5rem;max-height:70vh;">
        <table id="gainersTable">
          <thead>
            <tr>
              <th class="rightnum">#</th><th>Symbol</th><th class="rightnum">Last</th>
              <th class="rightnum">24h %</th><th class="rightnum">High</th>
              <th class="rightnum">Low</th><th class="rightnum">Vol (quote)</th><th>Chart</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- TECHNICALS -->
  <section id="technicals" class="section">
    <div class="card">
      <div class="row" style="align-items:flex-end; gap:.5rem;">
        <div style="flex:2">
          <div style="font-weight:700;font-family:var(--font-head);margin-bottom:.25rem;">Technicals</div>
          <div class="muted">Binance-native indicators with transparent math. Choose a ticker & timeframe and we’ll compute RSI, MACD, EMAs/SMAs, ADX/+DI/-DI. Then we map them to Buy/Neutral/Sell votes and explain why.</div>
          <div id="techStats" class="muted" style="margin-top:.35rem;font-size:.95rem;">Last: — · 24h High: — · 24h Low: —</div>
        </div>
        <div style="display:flex;gap:.5rem;justify-content:flex-end;align-items:flex-end;">
          <input id="techTicker" placeholder="BTC" style="width:120px;" />
          <select id="techTf" style="width:90px;">
            <option value="1h">1h</option>
            <option value="4h">4h</option>
            <option value="1d" selected>1d</option>
          </select>
          <button id="runTech" class="ghost">Analyze</button>
          <button id="scanPortfolio" class="ghost" title="Run Technicals for all portfolio tickers">Scan Portfolio</button>
          <button id="toggleHelp" class="ghost" title="How to read this">?</button>
        </div>
      </div>

      <div id="helpPanel" class="help">
        <div style="font-weight:700;margin-bottom:.35rem;">How to read this</div>
        <div class="hint">• <span class="pill pill-good"></span> green = bullish; <span class="pill pill-bad"></span> red = bearish; <span class="pill pill-neutral"></span> yellow = neutral/weak signal</div>
        <div class="hint">• RSI: green if ≥ Buy threshold but &lt; 70; yellow if 45–55 or ≥70; red if &lt; Sell threshold.</div>
        <div class="hint">• MACD: green when MACD&gt;Signal &amp; histogram&gt;0; red when both &lt;0; yellow near cross.</div>
        <div class="hint">• EMAs: green when price above 20/50/200; red when below all; yellow mixed.</div>
        <div class="hint">• +DI/−DI with ADX: needs ADX ≥ strong to matter; +DI&gt;−DI → green; −DI&gt;+DI → red; else yellow.</div>
        <div class="hint">• ADX: green when ≥ strong (trend powerful), otherwise yellow.</div>
      </div>

      <div class="row" style="margin-top:.75rem;gap:1rem;">
        <div class="card verdict" id="verdictCard" style="flex:1;min-width:260px;">
          <div id="techSummary" style="font-weight:700;">—</div>
          <div id="techCounts" class="muted" style="margin-top:.25rem;">—</div>
          <div id="techMeta" class="muted" style="margin-top:.25rem;font-size:.9rem;">—</div>
          <!-- Late Entry Caution (inline inside verdict card) -->
          <div style="margin-top:.5rem;">
            <div style="font-weight:700;margin-bottom:.25rem;">Late Entry Caution</div>
            <div id="lateEntryMessage" style="color:orange;font-size:.95rem;">Checking...</div>
          </div>
          <div class="sparkwrap">
            <div class="muted">24 bars close</div>
            <canvas id="sparkClose" width="180" height="36"></canvas>
          </div>
        </div>
        <div class="card" style="flex:2;min-width:320px;">
          <div style="font-weight:700;margin-bottom:.25rem;">Indicator values</div>
          <div style="overflow:auto;max-height:45vh;">
            <table>
              <thead>
                <tr>
                  <th class="sig"></th>
                  <th>Metric</th>
                  <th class="rightnum">Value</th>
                  <th>Note</th>
                </tr>
              </thead>
              <tbody id="techTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- === Trade Decision Panel (our new clear-English, decision engine) === -->
      <section id="trade-decision" class="tdp">
        <header class="tdp__header">
          <h2 id="tdp-title">Technicals — Loading…</h2>
          <span id="tdp-verdict" class="tdp__badge">—</span>
        </header>
        <div id="tdp-updated" class="tdp__updated">Updated: —</div>

        <div class="tdp__grid">
          <article class="tdp__card" id="tdp-readiness">
            <h3>Trade Readiness Score</h3>
            <p>Base confidence: —</p>
            <ul class="tdp__list" id="tdp-readiness-reasons"></ul>
          </article>

          <article class="tdp__card" id="tdp-alignment">
            <h3>Multi-Timeframe Alignment</h3>
            <p id="tdp-alignment-flags">1D: —  •  4H: —  •  1W: —</p>
            <p id="tdp-alignment-context" class="tdp__muted">Context: —</p>
          </article>

          <article class="tdp__card" id="tdp-rsi">
            <h3>RSI</h3>
            <p id="tdp-rsi-text">—</p>
          </article>

          <article class="tdp__card" id="tdp-macd">
            <h3>MACD</h3>
            <p id="tdp-macd-text">—</p>
          </article>

          <article class="tdp__card" id="tdp-ema">
            <h3>EMA Structure</h3>
            <p id="tdp-ema-text">—</p>
          </article>

          <article class="tdp__card" id="tdp-adx">
            <h3>ADX / DI</h3>
            <p id="tdp-adx-text">—</p>
          </article>

          <article class="tdp__card tdp__card--wide" id="tdp-trade-map">
            <h3>Trade Map</h3>
            <div class="tdp__map">
              <div><div class="tdp__label">Price</div><div id="tdp-price" class="tdp__value">—</div></div>
              <div><div class="tdp__label">Entry Zone</div><div id="tdp-entry" class="tdp__value">—</div></div>
              <div><div class="tdp__label">Target 1</div><div id="tdp-t1" class="tdp__value">—</div></div>
              <div><div class="tdp__label">Stop</div><div id="tdp-stop" class="tdp__value">—</div></div>
            </div>
            <p id="tdp-rr" class="tdp__muted">R:R (to T1): —</p>
          </article>

          <article class="tdp__card" id="tdp-risks">
            <h3>Risk Factors</h3>
            <ul class="tdp__list" id="tdp-risks-list"></ul>
          </article>

          <article class="tdp__card tdp__card--wide" id="tdp-context">
            <h3>Context Snapshot</h3>
            <p id="tdp-context-text">—</p>
          </article>
        </div>
      </section>
      <!-- PRICE CHART -->
<div class="card" style="margin-top:1rem;">
  <div style="font-weight:700;margin-bottom:.25rem;display:flex;align-items:center;justify-content:space-between">
    <span>Price chart</span>
    <span class="muted" id="chartPairLabel">—</span>
  </div>
  <div id="tv_chart_container"
       style="width:100%;height:320px;border:1px solid var(--border);border-radius:12px;overflow:hidden;"></div>
</div>

      <!-- === /Trade Decision Panel === -->

      <div class="card" style="margin-top:1rem;">
        <div style="font-weight:700;margin-bottom:.25rem;">Reasoning (how we decided)</div>

        <div class="row" style="gap:.75rem;margin:.35rem 0 0;align-items:flex-end;">
          <div style="flex:2;min-width:260px;">
            <div class="muted" style="margin-bottom:.25rem;">Thresholds (tweak & save to re-run):</div>
            <div class="row" style="gap:.5rem;">
              <label class="muted">RSI Buy ≥ <input id="cfgRsiBuy" type="number" step="1" min="0" max="100" style="width:80px;"></label>
              <label class="muted">RSI Sell &lt; <input id="cfgRsiSell" type="number" step="1" min="0" max="100" style="width:80px;"></label>
              <label class="muted">ADX Strong ≥ <input id="cfgAdx" type="number" step="1" min="0" max="100" style="width:90px;"></label>
              <label class="muted">MA Align Weight <input id="cfgAlign" type="number" step="0.1" min="0" max="5" style="width:110px;"></label>
              <button id="saveCfg" class="ghost">Save</button>
              <button id="resetCfg" class="ghost">Reset</button>
              <div class="muted" style="display:flex;gap:.4rem;align-items:center;">
                Presets:
                <span class="chip" id="presetCon">Conservative</span>
                <span class="chip" id="presetBal">Balanced</span>
                <span class="chip" id="presetAgg">Aggressive</span>
              </div>
              <label class="muted">Auto-refresh
                <select id="techAuto" style="width:110px;">
                  <option value="0">Off</option>
                  <option value="5">5 min</option>
                  <option value="10">10 min</option>
                  <option value="15">15 min</option>
                  <option value="30" selected>30 min</option>
                </select>
              </label>
            </div>
          </div>
        </div>

        <ul id="techReasons" style="margin:.25rem 0 0 1rem;line-height:1.45;"></ul>
        <div id="techTV" style="margin-top:.5rem;"></div>
      </div>

      <div class="card" style="margin-top:1rem;">
        <div style="font-weight:700;margin-bottom:.25rem;display:flex;align-items:center;justify-content:space-between">
          <span>Portfolio scan</span>
          <span id="scanProgress" class="muted"></span>
        </div>
        <div id="scanResults" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.75rem;"></div>
      </div>
    </div>
  </section>
</div>

<!-- Tiny sanity-check so you see the panel is wired; real logic will go in script.js next step -->
<script>
  (function () {
    const badge = document.getElementById('tdp-verdict');
    const title = document.getElementById('tdp-title');
    const updated = document.getElementById('tdp-updated');
    if (!badge || !title || !updated) return;
    title.textContent = 'Technicals — Ready';
    badge.textContent = 'Connected';
    badge.style.background = 'rgba(16,185,129,.15)'; // green
    badge.style.color = '#34d399';
    updated.textContent = 'Updated: waiting for data...';
  })();
</script>
<script src="https://s3.tradingview.com/tv.js"></script>
<script src="script.js"></script>
</body>
</html>

